
<!doctype html>
<html lang="zh" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>é‚€è¯·è¿”åˆ© Â· å¹³å°-ä¸€çº§ç”¨æˆ·-äºŒçº§ç”¨æˆ·</title>
  <meta name="color-scheme" content="dark">
  <style>
    :root{
      --panel: rgba(17,24,39,.65);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --border: rgba(148,163,184,.2);
      --brand:#2563eb;
    }
    body{margin:0; font:16px/1.6 Arial,Helvetica,sans-serif; color:var(--text); background:linear-gradient(135deg,#0f172a,#020617 60%,#000)}
    .container{max-width:980px; margin:0 auto; padding:20px}
    h1{margin:8px 0 12px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:16px; margin:12px 0}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    label{min-width:120px; color:var(--muted)}
    input,select{padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:transparent; color:inherit; min-width:220px}
    input:focus,select:focus{outline:none; box-shadow:0 0 0 3px rgba(37,99,235,.25)}
    .btn{display:inline-flex; gap:6px; align-items:center; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#0b1220; color:#e5e7eb; cursor:pointer; font-weight:700}
    .btn.primary{background:var(--brand); color:#fff; border-color:transparent}
    .grid{display:grid; gap:12px; grid-template-columns:1fr 1fr}
    @media (max-width:800px){ .grid{grid-template-columns:1fr} }
    .list{display:grid; gap:8px}
    .tag{display:inline-flex; gap:6px; align-items:center; background:rgba(255,255,255,.06); border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-size:12px}
    .muted{color:var(--muted); font-size:12px}
    .sep{height:1px; background:var(--border); margin:10px 0}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace}
  </style>
</head>
<body>
  <div class="container">
    <button id="langToggle" class="btn" style="float:right">English</button>
    <h1 data-t="heading">ğŸ¤ é‚€è¯·è¿”åˆ© Â· å¹³å°-ä¸€çº§ç”¨æˆ·-äºŒçº§ç”¨æˆ·</h1>
    <p class="muted" data-t="demoDesc">è¿™æ˜¯å‰ç«¯æ¼”ç¤ºï¼šç”Ÿæˆé‚€è¯·ç ã€è®°å½•æœ€å¤š 2 çº§ä¸Šçº§ã€è®¡ç®—è¿”åˆ©ã€‚ç”Ÿäº§ç¯å¢ƒè¯·æ¥å…¥åç«¯é£æ§ä¸ç»“ç®—ã€‚</p>

    <!-- æˆ‘çš„é‚€è¯·ç  -->
    <div class="card">
      <h3 data-t="myCode">æˆ‘çš„é‚€è¯·ç </h3>
      <div class="row">
        <label id="labelCode">é‚€è¯·ç  / é‚€è¯·åœ°å€</label>
        <input id="myCode" class="mono" readonly />
        <button class="btn" id="genCode" data-t="regenerate">é‡æ–°ç”Ÿæˆ</button>
      </div>
      <div class="row" style="margin-top:10px">
        <label id="labelLink">é‚€è¯·é“¾æ¥</label>
        <input id="inviteLink" class="mono" readonly />
        <button class="btn primary" id="copyLink" data-t="copyLink">å¤åˆ¶é“¾æ¥</button>
      </div>
      <div class="muted" id="noteLink" style="margin-top:6px">é»˜è®¤ä»¥<strong>å·²è¿æ¥é’±åŒ…åœ°å€</strong>ä½œä¸ºé‚€è¯·ç ï¼›å¦‚æœªè¿æ¥ï¼Œåˆ™ä½¿ç”¨æœ¬åœ°éšæœºç ã€‚é“¾æ¥å½¢å¦‚ï¼š<code class="mono">/crypto/index.html?ref=ä½ çš„ç </code></div>
      <div class="sep"></div>
      <div class="row">
        <a class="btn" href="/crypto/index.html" id="linkMarket">å»å¸‚åœºé¡µ</a>
        <button class="btn" id="simulateChild" data-t="addChild">æ·»åŠ æµ‹è¯•ä¸‹çº§ï¼ˆæœ¬åœ°ï¼‰</button>
      </div>
    </div>

    <!-- ä¸Šçº§é“¾ -->
    <div class="card">
      <h3 data-t="uplineTitle">æˆ‘çš„ä¸Šçº§é“¾ï¼ˆæœ€å¤š 2 çº§ï¼‰</h3>
      <div id="upline" class="list"></div>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="clearChain" data-t="clearChain">æ¸…é™¤æœ¬åœ°ä¸Šçº§é“¾</button>
      </div>
    </div>

    <!-- è¿”åˆ©è§„åˆ™ä¸ç»“ç®—å™¨ -->
    <div class="card">
      <h3 data-t="calcTitle">è¿”åˆ©è§„åˆ™ & æ¨¡æ‹Ÿç»“ç®—</h3>
      <div class="grid">
        <div>
          <div class="row"><label id="labelFeeRate">å¹³å°è´¹ç‡</label><input id="feeRate" type="number" step="0.01" value="0.20" /> <span>%</span></div>
          <div class="row"><label id="labelR1">ä¸€çº§è¿”åˆ©</label><input id="r1" type="number" step="0.1" value="30" /> <span>%</span></div>
          <div class="row"><label id="labelR2">äºŒçº§è¿”åˆ©</label><input id="r2" type="number" step="0.1" value="10" /> <span>%</span></div>
        </div>
        <div>
          <div class="row"><label id="labelOrderAmt">è®¢å•é‡‘é¢</label><input id="orderAmt" type="number" step="0.01" value="1000" /> <span>USD</span></div>
          <div class="row"><button class="btn primary" id="calc" data-t="calc">è®¡ç®—</button></div>
          <div id="result" class="list"></div>
        </div>
      </div>
      <div class="muted" id="example" style="margin-top:6px">ç¤ºä¾‹ï¼šè‹¥è®¢å• 1000 USDã€å¹³å°è´¹ç‡ 0.2%ï¼Œåˆ™å¹³å°è´¹ 2 USDï¼›æŒ‰ 30/10% è¿”åˆ©ï¼Œå¹³å°/ä¸€çº§/äºŒçº§åˆ†åˆ«ä¸º 1.20/0.60/0.20 USDã€‚</div>
    </div>

    <!-- æˆ‘çš„ä¸‹çº§ï¼ˆæœ¬åœ°æ¨¡æ‹Ÿï¼‰ -->
    <div class="card">
      <h3 data-t="downlineTitle">æˆ‘çš„ä¸‹çº§ï¼ˆæœ¬åœ°æ¼”ç¤ºï¼‰</h3>
      <div id="downline" class="list"></div>
      <div class="muted" data-t="downlineNote">ä»…åœ¨æœ¬åœ°ä¿å­˜ç”¨äºæ¼”ç¤ºã€‚çœŸå®ç¯å¢ƒéœ€åç«¯å­˜å‚¨ã€åä½œå¼Šã€ç»“ç®—ä¸å¯¼å‡ºã€‚</div>
    </div>
  </div>

  <script>
  ;(()=> {
    const $ = s => document.querySelector(s);
    const i18n = {
      zh:{
        pageTitle:'é‚€è¯·è¿”åˆ© Â· å¹³å°-ä¸€çº§ç”¨æˆ·-äºŒçº§ç”¨æˆ·',
        heading:'ğŸ¤ é‚€è¯·è¿”åˆ© Â· å¹³å°-ä¸€çº§ç”¨æˆ·-äºŒçº§ç”¨æˆ·',
        demoDesc:'è¿™æ˜¯å‰ç«¯æ¼”ç¤ºï¼šç”Ÿæˆé‚€è¯·ç ã€è®°å½•æœ€å¤š 2 çº§ä¸Šçº§ã€è®¡ç®—è¿”åˆ©ã€‚ç”Ÿäº§ç¯å¢ƒè¯·æ¥å…¥åç«¯é£æ§ä¸ç»“ç®—ã€‚',
        myCode:'æˆ‘çš„é‚€è¯·ç ',
        labelCode:'é‚€è¯·ç  / é‚€è¯·åœ°å€',
        regenerate:'é‡æ–°ç”Ÿæˆ',
        labelLink:'é‚€è¯·é“¾æ¥',
        copyLink:'å¤åˆ¶é“¾æ¥',
        copySuccess:'å·²å¤åˆ¶',
        copyFail:'å¤åˆ¶å¤±è´¥',
        noteLink:'é»˜è®¤ä»¥<strong>å·²è¿æ¥é’±åŒ…åœ°å€</strong>ä½œä¸ºé‚€è¯·ç ï¼›å¦‚æœªè¿æ¥ï¼Œåˆ™ä½¿ç”¨æœ¬åœ°éšæœºç ã€‚é“¾æ¥å½¢å¦‚ï¼š<code class="mono">/crypto/index.html?ref=ä½ çš„ç </code>',
        linkMarket:'å»å¸‚åœºé¡µ',
        addChild:'æ·»åŠ æµ‹è¯•ä¸‹çº§ï¼ˆæœ¬åœ°ï¼‰',
        uplineTitle:'æˆ‘çš„ä¸Šçº§é“¾ï¼ˆæœ€å¤š 2 çº§ï¼‰',
        noUpline:'æš‚æ— ä¸Šçº§è®°å½•ï¼ˆé€šè¿‡ä»–äººé‚€è¯·é“¾æ¥è®¿é—®å°†è‡ªåŠ¨è®°å½•ï¼‰ã€‚',
        clearChain:'æ¸…é™¤æœ¬åœ°ä¸Šçº§é“¾',
        calcTitle:'è¿”åˆ©è§„åˆ™ & æ¨¡æ‹Ÿç»“ç®—',
        feeRate:'å¹³å°è´¹ç‡',
        r1:'ä¸€çº§è¿”åˆ©',
        r2:'äºŒçº§è¿”åˆ©',
        orderAmount:'è®¢å•é‡‘é¢',
        calc:'è®¡ç®—',
        example:'ç¤ºä¾‹ï¼šè‹¥è®¢å• 1000 USDã€å¹³å°è´¹ç‡ 0.2%ï¼Œåˆ™å¹³å°è´¹ 2 USDï¼›æŒ‰ 30/10% è¿”åˆ©ï¼Œå¹³å°/ä¸€çº§/äºŒçº§åˆ†åˆ«ä¸º 1.20/0.60/0.20 USDã€‚',
        downlineTitle:'æˆ‘çš„ä¸‹çº§ï¼ˆæœ¬åœ°æ¼”ç¤ºï¼‰',
        downlineNote:'ä»…åœ¨æœ¬åœ°ä¿å­˜ç”¨äºæ¼”ç¤ºã€‚çœŸå®ç¯å¢ƒéœ€åç«¯å­˜å‚¨ã€åä½œå¼Šã€ç»“ç®—ä¸å¯¼å‡ºã€‚',
        noDownline:'æš‚æ— ä¸‹çº§ï¼ˆç‚¹å‡»ã€Œæ·»åŠ æµ‹è¯•ä¸‹çº§ã€æœ¬åœ°é€ æ•°ï¼‰ã€‚',
        tagPlatform:'å¹³å°',
        tagL1:'ä¸€çº§ç”¨æˆ·',
        tagL2:'äºŒçº§ç”¨æˆ·',
        tagL1Short:'ä¸€çº§',
        btnLang:'English'
      },
      en:{
        pageTitle:'Affiliate Rebate Â· Platform-Level1-Level2',
        heading:'ğŸ¤ Affiliate Rebate Â· Platform-Level1-Level2',
        demoDesc:'Front-end demo: generate invite codes, record up to 2 uplines, and compute rebates. In production, connect backend risk control and settlement.',
        myCode:'My Invite Code',
        labelCode:'Invite Code / Address',
        regenerate:'Regenerate',
        labelLink:'Invite Link',
        copyLink:'Copy Link',
        copySuccess:'Copied',
        copyFail:'Copy failed',
        noteLink:'By default, the <strong>connected wallet address</strong> is used as the invite code; if not connected, a local random code is used. Link format: <code class="mono">/crypto/index.html?ref=YOURCODE</code>',
        linkMarket:'Go to Market',
        addChild:'Add Test Downline (local)',
        uplineTitle:'My Upline Chain (max 2 levels)',
        noUpline:'No upline recorded (visit via someone else\'s invite link to capture).',
        clearChain:'Clear Local Upline Chain',
        calcTitle:'Rebate Rules & Simulator',
        feeRate:'Platform Fee Rate',
        r1:'Level 1 Rebate',
        r2:'Level 2 Rebate',
        orderAmount:'Order Amount',
        calc:'Calculate',
        example:'Example: if order is 1000 USD and platform fee rate is 0.2%, platform fee is 2 USD; with 30/10% rebates, platform/L1/L2 receive 1.20/0.60/0.20 USD respectively.',
        downlineTitle:'My Downline (local demo)',
        downlineNote:'Stored locally for demo only. Real systems need backend storage, anti-cheat, settlement and export.',
        noDownline:'No downline (click "Add Test Downline" to mock).',
        tagPlatform:'Platform',
        tagL1:'Level 1 User',
        tagL2:'Level 2 User',
        tagL1Short:'L1',
        btnLang:'ä¸­æ–‡'
      }
    };
    let lang = localStorage.getItem('affiliate_lang') || 'zh';
    document.documentElement.lang = lang;
    const t = k => i18n[lang][k] || k;
    function applyTexts(){
      $('#langToggle').textContent = t('btnLang');
      document.title = t('pageTitle');
      $('[data-t="heading"]').textContent = t('heading');
      $('[data-t="demoDesc"]').innerHTML = t('demoDesc');
      $('[data-t="myCode"]').textContent = t('myCode');
      $('#labelCode').textContent = t('labelCode');
      $('#genCode').textContent = t('regenerate');
      $('#labelLink').textContent = t('labelLink');
      $('#copyLink').textContent = t('copyLink');
      $('#noteLink').innerHTML = t('noteLink');
      $('#linkMarket').textContent = t('linkMarket');
      $('#simulateChild').textContent = t('addChild');
      $('[data-t="uplineTitle"]').textContent = t('uplineTitle');
      $('#clearChain').textContent = t('clearChain');
      $('#labelFeeRate').textContent = t('feeRate');
      $('#labelR1').textContent = t('r1');
      $('#labelR2').textContent = t('r2');
      $('#labelOrderAmt').textContent = t('orderAmount');
      $('#calc').textContent = t('calc');
      $('#example').textContent = t('example');
      $('[data-t="downlineTitle"]').textContent = t('downlineTitle');
      $('[data-t="downlineNote"]').textContent = t('downlineNote');
    }

    // è¯»å–é’±åŒ…åœ°å€ä½œä¸ºé»˜è®¤é‚€è¯·ç 
    const wallet = localStorage.getItem('wallet_addr') || '';
    function randomCode(){ return Array.from(crypto.getRandomValues(new Uint8Array(6))).map(b=>b.toString(36).slice(-1)).join('').toUpperCase(); }
    function getMyCode(){
      let code = localStorage.getItem('ref_my_code');
      if(!code){ code = wallet || ('U'+randomCode()); localStorage.setItem('ref_my_code', code); }
      return code;
    }
    function buildLink(){
      const origin = location.origin || '';
      const path = '/crypto/index.html';
      return `${origin}${path}?ref=${encodeURIComponent(getMyCode())}`;
    }
    // æ•æ‰ ?ref= å½¢æˆä¸Šçº§é“¾
    (function captureRef(){
      const ref = new URL(location.href).searchParams.get('ref');
      if(!ref) return;
      const old = JSON.parse(localStorage.getItem('ref_chain') || '[]');
      const set = new Set([ref, ...old]);
      const arr = Array.from(set).filter(x=>x && x!==getMyCode()).slice(0,2);
      localStorage.setItem('ref_chain', JSON.stringify(arr));
    })();

    function renderUpline(){
      const list = $('#upline'); list.innerHTML='';
      const chain = JSON.parse(localStorage.getItem('ref_chain') || '[]');
      if(!chain.length){ list.innerHTML = `<div class="muted">${t('noUpline')}</div>`; return; }
      const names = [t('tagL1'), t('tagL2')];
      chain.forEach((c,i)=>{
        const div = document.createElement('div');
        div.innerHTML = `<span class="tag">${names[i]}</span> <span class="mono">${c}</span>`;
        list.appendChild(div);
      });
    }
    function renderDownline(){
      const down = JSON.parse(localStorage.getItem('ref_downline') || '[]');
      const cont = $('#downline'); cont.innerHTML='';
      if(!down.length){ cont.innerHTML=`<div class="muted">${t('noDownline')}</div>`; return; }
      down.forEach(d=>{
        const div = document.createElement('div');
        div.innerHTML = `<span class="tag">${t('tagL1Short')}</span> <span class="mono">${d.code}</span> <span class="muted">${new Date(d.ts).toLocaleString()}</span>`;
        cont.appendChild(div);
      });
    }

    // äº‹ä»¶
    $('#myCode').value = getMyCode();
    $('#inviteLink').value = buildLink();
    $('#genCode').onclick = ()=>{ localStorage.removeItem('ref_my_code'); $('#myCode').value=getMyCode(); $('#inviteLink').value=buildLink(); };
      $('#copyLink').onclick = async()=>{ try{ await navigator.clipboard.writeText($('#inviteLink').value); alert(t('copySuccess')); }catch{ alert(t('copyFail')); } };
    $('#simulateChild').onclick = ()=>{
      const arr = JSON.parse(localStorage.getItem('ref_downline') || '[]');
      arr.push({ code: 'U'+Math.random().toString(36).slice(2,8).toUpperCase(), ts: Date.now() });
      localStorage.setItem('ref_downline', JSON.stringify(arr));
      renderDownline();
    };
    $('#clearChain').onclick = ()=>{ localStorage.removeItem('ref_chain'); renderUpline(); };
    $('#langToggle').onclick = ()=>{ lang = lang==='zh' ? 'en' : 'zh'; localStorage.setItem('affiliate_lang', lang); document.documentElement.lang = lang; applyTexts(); renderUpline(); renderDownline(); };

    // ç»“ç®—è®¡ç®—å™¨
    $('#calc').onclick = ()=>{
      const amt = Number($('#orderAmt').value||0);
      const feeRate = Number($('#feeRate').value||0)/100;
      const r1 = Number($('#r1').value||0)/100, r2 = Number($('#r2').value||0)/100;
      const fee = amt * feeRate;
      const v1 = fee * r1, v2 = fee * r2, p = fee - v1 - v2;
      $('#result').innerHTML = `
        <div><span class="tag">${t('tagPlatform')}</span> ${p.toFixed(6)} USD</div>
        <div><span class="tag">${t('tagL1')}</span> ${v1.toFixed(6)} USD</div>
        <div><span class="tag">${t('tagL2')}</span> ${v2.toFixed(6)} USD</div>
      `;
    };

    applyTexts();
    renderUpline(); renderDownline();
  })();
  </script>
</body>
</html>
